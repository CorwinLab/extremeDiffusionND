(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     32734,        790]
NotebookOptionsPosition[     30607,        754]
NotebookOutlinePosition[     31000,        770]
CellTagsIndexPosition[     30957,        767]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"pij", "[", "xij_", "]"}], " ", ":=", " ", 
   RowBox[{"Exp", "[", 
    RowBox[{
     RowBox[{"-", 
      RowBox[{"xij", "^", "2"}]}], " ", "/", " ", "2"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"computeBins", "[", 
    RowBox[{
    "lambdaC_", ",", " ", "binLambdaMin_", ",", " ", "binLambdaMax_", ",", 
     " ", "nBins_"}], "]"}], ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "bin", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"bin", " ", "=", " ", 
       RowBox[{"Which", "[", 
        RowBox[{
         RowBox[{"lambdaC", " ", ">", " ", "binLambdaMax"}], ",", " ", 
         "nBins", ",", "\[IndentingNewLine]", 
         RowBox[{"lambdaC", " ", "<", " ", "binLambdaMin"}], ",", " ", "1", 
         ",", "\[IndentingNewLine]", "True", ",", " ", 
         RowBox[{
          RowBox[{"Round", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"lambdaC", " ", "-", " ", "binLambdaMin"}], ")"}], "/", 
             
             RowBox[{"(", 
              RowBox[{"binLambdaMax", " ", "-", " ", "binLambdaMin"}], 
              ")"}]}], " ", "*", " ", 
            RowBox[{"(", 
             RowBox[{"nBins", "-", "1"}], ")"}]}], "]"}], "+", "1"}]}], " ", 
        "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"bin", ",", " ", "Module"}], "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TSymmetric", "[", "n_", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"RandMatrix", ",", " ", "SymmetrizedMatrix"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Create", " ", "random", " ", "matrix", " ", "of", " ", "normal", " ", 
       "distribution"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"RandMatrix", "=", 
       RowBox[{"RandomVariate", "[", 
        RowBox[{
         RowBox[{"NormalDistribution", "[", 
          RowBox[{"0", ",", " ", "1"}], "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"n", ",", " ", "n", ",", " ", "n"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Symmetrize", " ", "based", " ", "on", " ", "all", " ", "permutations",
         " ", "of", " ", "tensor"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"SymmetrizedMatrix", " ", "=", " ", 
       RowBox[{
        FractionBox["1", "6"], " ", 
        RowBox[{"(", 
         RowBox[{"RandMatrix", "+", 
          RowBox[{"TensorTranspose", "[", 
           RowBox[{"RandMatrix", ",", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1", ",", " ", "3"}], "}"}]}], "]"}], "+", 
          RowBox[{"TensorTranspose", "[", 
           RowBox[{"RandMatrix", ",", 
            RowBox[{"{", 
             RowBox[{"1", ",", "3", ",", "2"}], "}"}]}], "]"}], "+", 
          RowBox[{"TensorTranspose", "[", 
           RowBox[{"RandMatrix", ",", 
            RowBox[{"{", 
             RowBox[{"2", ",", "3", ",", "1"}], "}"}]}], "]"}], "+", 
          RowBox[{"TensorTranspose", "[", 
           RowBox[{"RandMatrix", ",", 
            RowBox[{"{", 
             RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}], "+", 
          RowBox[{"TensorTranspose", "[", 
           RowBox[{"RandMatrix", ",", 
            RowBox[{"{", 
             RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "]"}]}], ")"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "SymmetrizedMatrix", "]"}]}]}], 
    "\[IndentingNewLine]", 
    RowBox[{"(*", "*)"}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Crit", "[", "l_", "]"}], ":=", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Chop", "[", 
        RowBox[{"Norm", "[", 
         RowBox[{"Im", "[", "l", "]"}], "]"}], "]"}], "==", "0"}], ",", " ", 
      "True", ",", " ", "False"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "n", " ", "is", " ", "implicetly", " ", "defined", " ", "in", " ", "this", 
    " ", 
    RowBox[{"function", "!"}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"zeig", "[", 
    RowBox[{"rt_", ",", " ", "n_"}], "]"}], ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "v", ",", " ", "m", ",", " ", "a", ",", " ", "b", ",", " ", "c", ",", 
       " ", "RT", ",", " ", "eqns", ",", " ", "sol", ",", " ", "Jsol", ",", 
       " ", "Rsol", ",", " ", "Nsol", ",", " ", "NSsol"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"system", " ", "of", " ", "equations"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"eqns", " ", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Sum", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"rt", "[", 
                RowBox[{"[", "a", "]"}], "]"}], "[", 
               RowBox[{"[", "b", "]"}], "]"}], "[", 
              RowBox[{"[", "c", "]"}], "]"}], 
             RowBox[{"v", "[", "b", "]"}], " ", 
             RowBox[{"v", "[", "c", "]"}]}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"b", ",", " ", "1", ",", " ", "n"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"c", ",", " ", "1", ",", " ", "n"}], "}"}]}], "]"}], " ",
           "==", " ", 
          RowBox[{"v", "[", "a", "]"}]}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"a", ",", " ", "1", ",", "n"}], " ", "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "solution", " ", "of", " ", "system", " ", "of", " ", "equations"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"sol", " ", "=", 
       RowBox[{"NSolve", "[", 
        RowBox[{"eqns", ",", " ", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"v", "[", "a", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"a", ",", " ", "1", ",", " ", "n"}], "}"}]}], " ", 
          "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "reformating", " ", "the", " ", "solutions", " ", "to", " ", "a", " ", 
        "list"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Jsol", " ", "=", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"v", "[", "a", "]"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"a", ",", " ", "1", ",", " ", "n"}], "}"}]}], "]"}], "/.", 
        "sol"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"remove", " ", "trivial", " ", "solutions"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"Rsol", " ", "=", 
       RowBox[{"Select", "[", 
        RowBox[{"Jsol", ",", " ", "Crit"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "replace", " ", "each", " ", "solution", " ", "with", " ", "its", " ", 
        "norm"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Nsol", " ", "=", " ", 
       RowBox[{"Norm", "/@", "Rsol"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "sort", " ", "solutions", " ", "in", " ", "increasing", " ", "value"}],
        "*)"}], "\[IndentingNewLine]", 
      RowBox[{"NSsol", " ", "=", " ", 
       RowBox[{"Sort", "[", "Nsol", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"NSsol", " ", "=", " ", 
       RowBox[{"Select", "[", 
        RowBox[{"NSsol", ",", " ", 
         RowBox[{
          RowBox[{"#", ">", "0"}], "&"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{
         "If", " ", "there", " ", "is", " ", "only", " ", "one", " ", "Z"}], 
         "-", "eigenvalue"}], ",", " ", 
        RowBox[{"which", " ", "has", " ", "to", " ", "be", " ", "zero"}], ",",
         " ", 
        RowBox[{"it", " ", "will", " ", "return", " ", 
         RowBox[{"zero", ".", " ", "We"}], " ", "need", " ", "to", " ", 
         "account", " ", "for", " ", "this", " ", "when", " ", "we", " ", 
         "implement", " ", "the", " ", 
         RowBox[{"function", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "NSsol", "]"}], ">=", "1"}], ",", " ", 
         RowBox[{"1", "/", 
          RowBox[{"NSsol", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ",", " ", "0"}], "]"}], 
       "]"}]}]}], "\[IndentingNewLine]", 
    RowBox[{"(*", "*)"}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.955201299742819*^9, 3.955201326123219*^9}, {
  3.9552014363688183`*^9, 3.9552014946611357`*^9}, {3.9552015979960537`*^9, 
  3.955201626928293*^9}, {3.955201702554346*^9, 3.955201725367378*^9}, {
  3.9552017649000893`*^9, 3.955201765749728*^9}, {3.9552018348029327`*^9, 
  3.9552019996989307`*^9}, {3.955202036629203*^9, 3.9552020517870493`*^9}, {
  3.955204350358025*^9, 3.955204372015273*^9}, {3.955204460976597*^9, 
  3.955204511457676*^9}, {3.955204838617929*^9, 3.955204843433669*^9}, {
  3.955204934531567*^9, 3.955204948125061*^9}, {3.955205015744235*^9, 
  3.9552050587449512`*^9}, {3.955208227764536*^9, 3.955208244354403*^9}, {
  3.955208342643746*^9, 3.955208371570266*^9}, {3.955208860760509*^9, 
  3.955208861286646*^9}, {3.955209012102909*^9, 3.95520905591556*^9}, {
  3.955467684094947*^9, 3.955467697896078*^9}, {3.955467855560967*^9, 
  3.955467856861019*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"2b1e4ceb-54c5-474f-959c-614d915e964f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metropolisEigenValues", "[", 
   RowBox[{
   "outSteps_", ",", " ", "inSteps_", ",", " ", "n_", ",", " ", "b_", ",", 
    " ", "nBins_", ",", " ", "width_", ",", " ", "binLambdaMin_", ",", " ", 
    "binLambdaMax_"}], "]"}], " ", ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "logWeights", ",", " ", "histogram", ",", " ", "nc", ",", " ", "tensor", 
      ",", " ", "lambdaMax", ",", " ", "accepted", ",", " ", "rejected", ",", 
      " ", "i", ",", " ", "j", ",", " ", "indices", ",", " ", "proposedJump", 
      ",", " ", "newTensor", ",", " ", "lambdaMaxNew", ",", " ", "binLambda", 
      ",", " ", "binLambdaNew", ",", " ", "monteCarloProbability", ",", " ", 
      "choppedHistogram", ",", " ", "f"}], "}"}], ",", "\[IndentingNewLine]", 
    
    RowBox[{
     RowBox[{"f", " ", "=", " ", 
      RowBox[{"Exp", "[", "1", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"logWeights", " ", "=", " ", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0", ",", "nBins"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"histogram", " ", "=", " ", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0", ",", " ", "nBins"}], "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"nc", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
     RowBox[{"tensor", " ", "=", " ", 
      RowBox[{"TSymmetric", "[", "n", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"lambdaMax", " ", "=", " ", 
      RowBox[{"zeig", "[", 
       RowBox[{"tensor", ",", " ", "n"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"accepted", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
     RowBox[{"rejected", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"i", "=", "0"}], ",", " ", 
       RowBox[{"i", "<", "outSteps"}], ",", " ", 
       RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"j", "=", "0"}], ",", " ", 
          RowBox[{"j", "<", "inSteps"}], ",", " ", 
          RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"indices", " ", "=", " ", 
            RowBox[{"RandomInteger", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"1", ",", " ", "n"}], "}"}], ",", "3"}], "]"}]}], ";", 
           " ", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "The", " ", "factor", " ", "of", " ", "6", " ", "is", " ", "due", 
             " ", "to", " ", "the", " ", "symmetries", " ", "of", " ", "the", 
             " ", "system"}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"proposedJump", " ", "=", " ", 
            RowBox[{"width", " ", "*", " ", 
             RowBox[{
              RowBox[{"RandomVariate", "[", 
               RowBox[{"NormalDistribution", "[", 
                RowBox[{"0", ",", " ", "1"}], "]"}], "]"}], " ", "/", " ", 
              "6"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"newTensor", " ", "=", " ", "tensor"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "Need", " ", "to", " ", "enforce", " ", "the", " ", 
             "symmetries"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"newTensor", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"indices", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
               RowBox[{"indices", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
               RowBox[{"indices", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}], "]"}], "]"}], " ", "+=", 
            " ", "proposedJump"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"newTensor", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"indices", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
               RowBox[{"indices", "[", 
                RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
               RowBox[{"indices", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], " ", "+=", 
            " ", "proposedJump"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"newTensor", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"indices", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
               RowBox[{"indices", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
               RowBox[{"indices", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}], "]"}], "]"}], " ", "+=", 
            " ", "proposedJump"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"newTensor", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"indices", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
               RowBox[{"indices", "[", 
                RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
               RowBox[{"indices", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], " ", "+=", 
            " ", "proposedJump"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"newTensor", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"indices", "[", 
                RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
               RowBox[{"indices", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
               RowBox[{"indices", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], " ", "+=", 
            " ", "proposedJump"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"newTensor", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"indices", "[", 
                RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
               RowBox[{"indices", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
               RowBox[{"indices", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], " ", "+=", 
            " ", "proposedJump"}], ";", "\[IndentingNewLine]", 
           RowBox[{"lambdaMaxNew", " ", "=", " ", 
            RowBox[{"zeig", "[", 
             RowBox[{"newTensor", ",", " ", "n"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"binLambda", " ", "=", " ", 
            RowBox[{"computeBins", "[", 
             RowBox[{
             "lambdaMax", ",", " ", "binLambdaMin", ",", " ", "binLambdaMax", 
              ",", " ", "nBins"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"binLambdaNew", " ", "=", " ", 
            RowBox[{"computeBins", "[", 
             RowBox[{
             "lambdaMaxNew", ",", " ", "binLambdaMin", ",", " ", 
              "binLambdaMax", ",", " ", "nBins"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"monteCarloProbability", " ", "=", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"pij", "[", 
               RowBox[{"newTensor", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"indices", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                  RowBox[{"indices", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
                  RowBox[{"indices", "[", 
                   RowBox[{"[", "3", "]"}], "]"}]}], "]"}], "]"}], "]"}], " ",
               "/", " ", 
              RowBox[{"pij", "[", 
               RowBox[{"tensor", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"indices", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                  RowBox[{"indices", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
                  RowBox[{"indices", "[", 
                   RowBox[{"[", "3", "]"}], "]"}]}], "]"}], "]"}], "]"}]}], 
             " ", "*", 
             RowBox[{"Exp", "[", 
              RowBox[{
               RowBox[{"logWeights", "[", 
                RowBox[{"[", "binLambdaNew", "]"}], "]"}], " ", "-", " ", 
               RowBox[{"logWeights", "[", 
                RowBox[{"[", "binLambda", "]"}], "]"}]}], 
              "\[IndentingNewLine]", "]"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"RandomVariate", "[", 
               RowBox[{"UniformDistribution", "[", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "1"}], "}"}], "]"}], "]"}], " ", "<", " ", 
              "monteCarloProbability"}], ",", "\[IndentingNewLine]", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"lambdaMax", " ", "=", " ", "lambdaMaxNew"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"tensor", " ", "=", " ", "newTensor"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"accepted", " ", "+=", "1"}]}], ")"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"(", 
              RowBox[{"rejected", "+=", "1"}], ")"}]}], "\[IndentingNewLine]",
             "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"binLambda", " ", "=", " ", 
            RowBox[{"computeBins", "[", 
             RowBox[{
             "lambdaMax", ",", " ", "binLambdaMin", ",", " ", "binLambdaMax", 
              ",", " ", "nBins"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"logWeights", "[", 
             RowBox[{"[", "binLambda", "]"}], "]"}], " ", "-=", " ", 
            RowBox[{"Log", "[", "f", "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"histogram", "[", 
             RowBox[{"[", "binLambda", "]"}], "]"}], " ", "+=", " ", "1"}], 
           ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"choppedHistogram", " ", "=", " ", 
         RowBox[{"Rest", "[", 
          RowBox[{"Most", "[", "histogram", "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Min", "[", "choppedHistogram", "]"}], " ", ">", " ", 
           RowBox[{
            RowBox[{"Mean", "[", "choppedHistogram", "]"}], "*", "b"}]}], ",",
           " ", "\[IndentingNewLine]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"f", "=", 
             RowBox[{"Sqrt", "[", "f", "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"histogram", " ", "=", 
             RowBox[{"ConstantArray", "[", 
              RowBox[{"0", ",", " ", "nBins"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"nc", "+=", " ", "1"}], ";", "\[IndentingNewLine]", 
            RowBox[{"Print", "[", 
             RowBox[{"{", 
              RowBox[{"nc", ",", " ", "f"}], "}"}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Export", "[", 
             RowBox[{
              RowBox[{"ToString", "[", 
               RowBox[{"StringForm", "[", 
                RowBox[{
                "\"\<Weights_``_``.txt\>\"", ",", " ", "nc", ",", " ", "n"}], 
                "]"}], "]"}], ",", "logWeights"}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Export", "[", 
             RowBox[{
              RowBox[{"ToString", "[", 
               RowBox[{"StringForm", "[", 
                RowBox[{
                "\"\<Histogram_``_``.txt\>\"", ",", " ", "nc", ",", " ", 
                 "n"}], "]"}], "]"}], ",", " ", "histogram"}], "]"}], ";"}], 
           ")"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"logWeights", ",", " ", "histogram", ",", " ", "nc"}], "}"}], 
       ",", " ", "Module"}], "]"}], ";"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->CompressedData["
1:eJwd0VtI02EYBvApoiAqU8ihDtSVFdv0Im04//MQOVs50RUGrhaoiLvSSJ2n
aXOVSoIuUxqyKEwslWKoSaWomEjEzBNMGRseYJTDbLhSpqh9z3fx8oPngefm
jS0qv1niy2Kx+OQgt3Y21FP9+0qpdIEDz+Z4uPDW3QMh/JHjYKCfnn0V2gdW
rkGbOkEOO1t4Chhur86Hg6sqJTRvfiiGhxccepjVo2iFfwTybsg/Eb2GFzPt
QzCoWzoBxxjxNLwxYJ6DSvGuhfbDUytwLy5mDX5bCnbBj/VJXuhe7D2CZbXW
Uzh5PcDnLzFDsewPfeyL4fB2Kq8BylRhOtjMTnsCEyPU1P2odM4+cdkzxIUF
rig+9A9yCGFkmzkZhl3uEsPox88yYYiTyYaDT9/nwp8NX6g9Bd9LoNWwQNU9
lLbDvOC31PtTx8+hMbWqC0rWvW/oXp1fH5wb/Rx6QHz5z021sDQMtLp3qOdH
2qVwS/goG8ofnKuAsnsm6sx4Qh1s7JQ0w0Bn25nyGvJnm4MDN+Mi4uHWdpOI
5ko2A6eN8+lwx5ssh5OvMvJhQL3mDjxha1Vw1BCphWUvKjugoUltqSR+EqzN
w8YUlayK+KvfRNVr3xXCmUJXEdzglWqMRFuvrgZKDi+tm4jOryLqf5aCdB8=

  "],ExpressionUUID->"cdc77cc0-1358-433d-98c0-098619c7673e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"outSteps", "=", "10000"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"inSteps", "=", "100"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"n", "=", "3"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"b", "=", "0.92"}], ";"}], " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"width", "=", "1.5"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"binLambdaMin", "=", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"binLambaMax", "=", "14"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"nBins", "=", "30"}], ";"}], " "}]}], "Input",
 CellChangeTimes->{{3.9552081293616247`*^9, 3.955208218816674*^9}, {
   3.955208441767667*^9, 3.9552084426179857`*^9}, {3.955208798588415*^9, 
   3.955208799283186*^9}, {3.955209159797606*^9, 3.9552091599179583`*^9}, {
   3.95520922226204*^9, 3.9552092223674097`*^9}, 3.955209324737666*^9, {
   3.955209371656451*^9, 3.9552093849820967`*^9}, 3.95520949113241*^9, {
   3.9552101317590227`*^9, 3.955210134115302*^9}, {3.955211167874648*^9, 
   3.9552111928645477`*^9}, {3.955211235713297*^9, 3.9552112360767937`*^9}, {
   3.95545669791339*^9, 3.955456702235413*^9}, {3.955457245760277*^9, 
   3.955457249512334*^9}, 3.955459210941828*^9, {3.955459257569521*^9, 
   3.95545925773912*^9}, {3.955462974710436*^9, 3.955462998310665*^9}, {
   3.955540146811369*^9, 3.955540159129665*^9}, {3.9555401902147293`*^9, 
   3.955540190388473*^9}, {3.9555402970821342`*^9, 3.955540297912559*^9}, {
   3.955540807658238*^9, 3.955540832049445*^9}},
 CellLabel->"In[25]:=",ExpressionUUID->"a4d25b62-341b-4bcf-8844-8969dd3610f3"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"finalData", " ", "=", " ", 
   RowBox[{"AbsoluteTiming", "[", 
    RowBox[{"metropolisEigenValues", "[", 
     RowBox[{
     "outSteps", ",", " ", "inSteps", ",", " ", "n", ",", " ", "b", ",", " ", 
      "nBins", ",", " ", "width", ",", " ", "binLambdaMin", ",", " ", 
      "binLambaMax"}], "]"}], " ", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.955208188271619*^9, 3.955208205165457*^9}, 
   3.955208264714954*^9, 3.95521015128096*^9, {3.955211238217938*^9, 
   3.955211239865583*^9}, {3.955459245936624*^9, 3.955459280634736*^9}, {
   3.955540938360155*^9, 3.9555409398707867`*^9}},
 CellLabel->"In[33]:=",ExpressionUUID->"0ac24a4a-2719-45a2-a373-869396233190"],

Cell[BoxData[
 TemplateBox[{
  "General", "munfl", 
   "\"\\!\\(\\*RowBox[{\\\"Exp\\\", \\\"[\\\", RowBox[{\\\"-\\\", \\\"957.`\\\
\"}], \\\"]\\\"}]\\) is too small to represent as a normalized machine \
number; precision may be lost.\"", 2, 33, 1, 23737284978255327606, "Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.955541832683675*^9},
 CellLabel->
  "During evaluation of \
In[33]:=",ExpressionUUID->"312ce954-99bb-4b52-8bcb-6a42c4372668"],

Cell[BoxData[
 TemplateBox[{
  "General", "munfl", 
   "\"\\!\\(\\*RowBox[{\\\"Exp\\\", \\\"[\\\", RowBox[{\\\"-\\\", \\\"956.`\\\
\"}], \\\"]\\\"}]\\) is too small to represent as a normalized machine \
number; precision may be lost.\"", 2, 33, 2, 23737284978255327606, "Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.95554183276674*^9},
 CellLabel->
  "During evaluation of \
In[33]:=",ExpressionUUID->"085d8c75-be25-4994-8a21-2321b63d53b1"],

Cell[BoxData[
 TemplateBox[{
  "General", "munfl", 
   "\"\\!\\(\\*RowBox[{\\\"Exp\\\", \\\"[\\\", RowBox[{\\\"-\\\", \
\\\"1028.`\\\"}], \\\"]\\\"}]\\) is too small to represent as a normalized \
machine number; precision may be lost.\"", 2, 33, 3, 23737284978255327606, 
   "Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.955541832912883*^9},
 CellLabel->
  "During evaluation of \
In[33]:=",ExpressionUUID->"1600bec6-0684-43b1-a56f-e0b5fef914e0"],

Cell[BoxData[
 TemplateBox[{
  "General", "stop", 
   "\"Further output of \\!\\(\\*StyleBox[RowBox[{\\\"General\\\", \
\\\"::\\\", \\\"munfl\\\"}], \\\"MessageName\\\"]\\) will be suppressed \
during this calculation.\"", 2, 33, 4, 23737284978255327606, "Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.955541832924468*^9},
 CellLabel->
  "During evaluation of \
In[33]:=",ExpressionUUID->"33ce0e22-3494-4c0e-95ce-d512ebbe8ee9"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"1", ",", 
   SqrtBox["\[ExponentialE]"]}], "}"}]], "Print",
 CellChangeTimes->{3.9555418640197983`*^9},
 CellLabel->
  "During evaluation of \
In[33]:=",ExpressionUUID->"c078217c-1378-4959-a19c-9449febcf8c7"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"2", ",", 
   SuperscriptBox["\[ExponentialE]", 
    RowBox[{"1", "/", "4"}]]}], "}"}]], "Print",
 CellChangeTimes->{3.9555429842967443`*^9},
 CellLabel->
  "During evaluation of \
In[33]:=",ExpressionUUID->"19a91019-eddc-4fc0-ac09-be86631a34d7"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"3", ",", 
   SuperscriptBox["\[ExponentialE]", 
    RowBox[{"1", "/", "8"}]]}], "}"}]], "Print",
 CellChangeTimes->{3.955543609028339*^9},
 CellLabel->
  "During evaluation of \
In[33]:=",ExpressionUUID->"f1bb1e84-e504-45df-a152-5ba767cf21ce"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"4", ",", 
   SuperscriptBox["\[ExponentialE]", 
    RowBox[{"1", "/", "16"}]]}], "}"}]], "Print",
 CellChangeTimes->{3.955544839278286*^9},
 CellLabel->
  "During evaluation of \
In[33]:=",ExpressionUUID->"e71e6dcf-533c-459b-b025-db4f30234df9"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"5", ",", 
   SuperscriptBox["\[ExponentialE]", 
    RowBox[{"1", "/", "32"}]]}], "}"}]], "Print",
 CellChangeTimes->{3.955545377280114*^9},
 CellLabel->
  "During evaluation of \
In[33]:=",ExpressionUUID->"11757457-ae2b-42df-8266-29a940c90475"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"6", ",", 
   SuperscriptBox["\[ExponentialE]", 
    RowBox[{"1", "/", "64"}]]}], "}"}]], "Print",
 CellChangeTimes->{3.955547044116514*^9},
 CellLabel->
  "During evaluation of \
In[33]:=",ExpressionUUID->"d767409c-36e0-4b72-94ed-5da34e3e6188"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"7", ",", 
   SuperscriptBox["\[ExponentialE]", 
    RowBox[{"1", "/", "128"}]]}], "}"}]], "Print",
 CellChangeTimes->{3.955548992906301*^9},
 CellLabel->
  "During evaluation of \
In[33]:=",ExpressionUUID->"a0729c84-ed2b-480f-9df4-3b6d6e49abe0"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"8", ",", 
   SuperscriptBox["\[ExponentialE]", 
    RowBox[{"1", "/", "256"}]]}], "}"}]], "Print",
 CellChangeTimes->{3.95555101856846*^9},
 CellLabel->
  "During evaluation of \
In[33]:=",ExpressionUUID->"171d4ea4-a4f1-4dd3-824b-6cbe55cbe47e"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"9", ",", 
   SuperscriptBox["\[ExponentialE]", 
    RowBox[{"1", "/", "512"}]]}], "}"}]], "Print",
 CellChangeTimes->{3.9555549352426558`*^9},
 CellLabel->
  "During evaluation of \
In[33]:=",ExpressionUUID->"55327654-f40f-475e-95bb-1bb1ca9413c8"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"10", ",", 
   SuperscriptBox["\[ExponentialE]", 
    RowBox[{"1", "/", "1024"}]]}], "}"}]], "Print",
 CellChangeTimes->{3.9555583756281567`*^9},
 CellLabel->
  "During evaluation of \
In[33]:=",ExpressionUUID->"b3f4df8e-5e8d-4aae-8760-bbc255c57a8a"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"11", ",", 
   SuperscriptBox["\[ExponentialE]", 
    RowBox[{"1", "/", "2048"}]]}], "}"}]], "Print",
 CellChangeTimes->{3.955565321124708*^9},
 CellLabel->
  "During evaluation of \
In[33]:=",ExpressionUUID->"a7305c35-12bb-4196-8905-cc1f92850a49"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{925, 1016},
WindowMargins->{{Automatic, 0}, {0, Automatic}},
FrontEndVersion->"12.2 for Linux x86 (64-bit) (December 12, 2020)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"cd554be0-5b03-49ba-8c17-82316d72c99b"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 9806, 239, 917, "Input",ExpressionUUID->"2b1e4ceb-54c5-474f-959c-614d915e964f"],
Cell[10367, 261, 12803, 278, 1219, "Input",ExpressionUUID->"cdc77cc0-1358-433d-98c0-098619c7673e"],
Cell[23173, 541, 1649, 32, 185, "Input",ExpressionUUID->"a4d25b62-341b-4bcf-8844-8969dd3610f3"],
Cell[CellGroupData[{
Cell[24847, 577, 705, 13, 53, "Input",ExpressionUUID->"0ac24a4a-2719-45a2-a373-869396233190"],
Cell[25555, 592, 468, 10, 22, "Message",ExpressionUUID->"312ce954-99bb-4b52-8bcb-6a42c4372668"],
Cell[26026, 604, 467, 10, 22, "Message",ExpressionUUID->"085d8c75-be25-4994-8a21-2321b63d53b1"],
Cell[26496, 616, 473, 11, 22, "Message",ExpressionUUID->"1600bec6-0684-43b1-a56f-e0b5fef914e0"],
Cell[26972, 629, 452, 10, 22, "Message",ExpressionUUID->"33ce0e22-3494-4c0e-95ce-d512ebbe8ee9"],
Cell[CellGroupData[{
Cell[27449, 643, 248, 7, 26, "Print",ExpressionUUID->"c078217c-1378-4959-a19c-9449febcf8c7"],
Cell[27700, 652, 285, 8, 26, "Print",ExpressionUUID->"19a91019-eddc-4fc0-ac09-be86631a34d7"],
Cell[27988, 662, 283, 8, 26, "Print",ExpressionUUID->"f1bb1e84-e504-45df-a152-5ba767cf21ce"],
Cell[28274, 672, 284, 8, 26, "Print",ExpressionUUID->"e71e6dcf-533c-459b-b025-db4f30234df9"],
Cell[28561, 682, 284, 8, 26, "Print",ExpressionUUID->"11757457-ae2b-42df-8266-29a940c90475"],
Cell[28848, 692, 284, 8, 26, "Print",ExpressionUUID->"d767409c-36e0-4b72-94ed-5da34e3e6188"],
Cell[29135, 702, 285, 8, 26, "Print",ExpressionUUID->"a0729c84-ed2b-480f-9df4-3b6d6e49abe0"],
Cell[29423, 712, 284, 8, 26, "Print",ExpressionUUID->"171d4ea4-a4f1-4dd3-824b-6cbe55cbe47e"],
Cell[29710, 722, 287, 8, 26, "Print",ExpressionUUID->"55327654-f40f-475e-95bb-1bb1ca9413c8"],
Cell[30000, 732, 289, 8, 26, "Print",ExpressionUUID->"b3f4df8e-5e8d-4aae-8760-bbc255c57a8a"],
Cell[30292, 742, 287, 8, 26, "Print",ExpressionUUID->"a7305c35-12bb-4196-8905-cc1f92850a49"]
}, Open  ]]
}, Open  ]]
}
]
*)

